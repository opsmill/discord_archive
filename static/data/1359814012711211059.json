[{"thread":{"id":"1359814012711211059","type":11,"last_message_id":"1359920128224919574","flags":0,"guild_id":"1212332642801025064","name":"Schema deletion and upgrades","parent_id":"1301914405176475729","rate_limit_per_user":0,"bitrate":64000,"user_limit":0,"rtc_region":null,"owner_id":"583750986527408128","thread_metadata":{"archived":true,"archive_timestamp":"2025-05-10T15:58:06.180000+00:00","auto_archive_duration":4320,"locked":false,"create_timestamp":"2025-04-10T08:55:24.753000+00:00"},"message_count":15,"member_count":4,"total_message_sent":15,"applied_tags":["1301915943663960064"]},"messages":[{"type":0,"content":"I haven't seen these bugs fixed yet, but I ran into a lot of issues updating or deleting generics in the schema. My only solution to resolve these was to delete everything and start over because I couldn't edit any of the generics.\n\nhttps://github.com/opsmill/infrahub/issues/5388\n\nhttps://github.com/opsmill/infrahub/issues/5384","mentions":[],"mention_roles":[],"attachments":[],"embeds":[{"type":"article","url":"https://github.com/opsmill/infrahub/issues/5388","title":"bug: unable to remove a generic from the schema ¬∑ Issue #5388 ¬∑ o...","description":"Component API Server / GraphQL Infrahub version 1.1.1 Current Behavior You get a HTTP 404 response when you try to delete a generic from the schema Expected Behavior The generic is removed from the...","color":1975079,"provider":{"name":"GitHub"},"thumbnail":{"url":"https://opengraph.githubassets.com/9ce6bd0c730a56fc3de84ca4856c603971d9e9c18f0e4f7b7e378848899dfca9/opsmill/infrahub/issues/5388","proxy_url":"https://images-ext-1.discordapp.net/external/MwY7FAsuRv3kPxbK6d2eSAOAPKxiXblYPOoLjLUffRQ/https/opengraph.githubassets.com/9ce6bd0c730a56fc3de84ca4856c603971d9e9c18f0e4f7b7e378848899dfca9/opsmill/infrahub/issues/5388","width":1200,"height":600,"content_type":"image/png","placeholder":"+vcFDIKGiZiJiHeYZn9anmD5Jg==","placeholder_version":1,"flags":0},"content_scan_version":2},{"type":"article","url":"https://github.com/opsmill/infrahub/issues/5384","title":"bug: unable to remove a relationship to a generic from a schema ext...","description":"Component API Server / GraphQL Infrahub version 1.1.1 Current Behavior When you try to delete a relationship from a schema extension, that references a generic that also gets removed during the sam...","color":1975079,"provider":{"name":"GitHub"},"thumbnail":{"url":"https://opengraph.githubassets.com/885c49fe5454ff29762714530644c0ffb939b372a0981ccb6a9de55811909e20/opsmill/infrahub/issues/5384","proxy_url":"https://images-ext-1.discordapp.net/external/UULcn6Nnha0Pyn43fOUhEKQ0kD4ol88sv3PwLMnGIrM/https/opengraph.githubassets.com/885c49fe5454ff29762714530644c0ffb939b372a0981ccb6a9de55811909e20/opsmill/infrahub/issues/5384","width":1200,"height":600,"description":"Component API Server / GraphQL Infrahub version 1.1.1 Current Behavior When you try to delete a relationship from a schema extension, that references a generic that also gets removed during the sam...","flags":0},"content_scan_version":2}],"timestamp":"2025-04-10T15:57:04.663000+00:00","edited_timestamp":"2025-04-10T15:59:14.505000+00:00","flags":0,"components":[],"id":"1359920128224919574","channel_id":"1359814012711211059","author":{"id":"123965055434883073","username":"themar4321","avatar":null,"discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"Themar","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":null,"primary_guild":null},"pinned":false,"mention_everyone":false,"tts":false,"position":14},{"type":0,"content":"you have some infromation in the topic schema https://docs.infrahub.app/topics/schema#rename-existing-elements, \n\ntldr you will have to add the `id` which can be found in the http://localhost:8000/schema","mentions":[],"mention_roles":[],"attachments":[],"embeds":[{"type":"article","url":"https://docs.infrahub.app/topics/schema","title":"Schema | Infrahub Documentation","description":"In Infrahub, the schema is at the center of most things and our goal is to provide as much flexibility as possible to allow users to extend and customize the schema.","content_scan_version":2}],"timestamp":"2025-04-10T12:07:30.146000+00:00","edited_timestamp":null,"flags":0,"components":[],"id":"1359862353713430740","channel_id":"1359814012711211059","author":{"id":"1133022375051542558","username":"shabear_dis","avatar":"e5046d674427373d76e2dde9dc74feb5","discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"Benito","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":null,"primary_guild":null},"pinned":false,"mention_everyone":false,"tts":false,"position":13,"reactions":[{"emoji":{"id":null,"name":"üëç"},"count":1,"count_details":{"burst":0,"normal":1},"burst_colors":[],"me_burst":false,"burst_me":false,"me":false,"burst_count":0}]},{"type":0,"content":"I am probably just missing something but it does not say exactly how to do it. Say I name an attribute ‚ÄòCalbe‚Äô but it was supposed to be ‚ÄòCable‚Äô. How do I perform that migration/name change? I am referring to the fact that ‚Äúname‚Äù for Attribute has migration_required.","mentions":[],"mention_roles":[],"attachments":[],"embeds":[],"timestamp":"2025-04-10T10:57:35.677000+00:00","edited_timestamp":null,"flags":0,"components":[],"id":"1359844760835194901","channel_id":"1359814012711211059","author":{"id":"583750986527408128","username":"davidalmgren","avatar":null,"discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"David A","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":null,"primary_guild":null},"pinned":false,"mention_everyone":false,"tts":false,"position":12},{"type":0,"content":"we have this reference page https://docs.infrahub.app/reference/schema/validator-migration, there is a link towards it on the topic schema page (https://docs.infrahub.app/topics/schema#restrictions)","mentions":[],"mention_roles":[],"attachments":[],"embeds":[{"type":"article","url":"https://docs.infrahub.app/topics/schema","title":"Schema | Infrahub Documentation","description":"In Infrahub, the schema is at the center of most things and our goal is to provide as much flexibility as possible to allow users to extend and customize the schema.","content_scan_version":2}],"timestamp":"2025-04-10T10:44:09.208000+00:00","edited_timestamp":"2025-04-10T10:45:56.590000+00:00","flags":0,"components":[],"id":"1359841378259046633","channel_id":"1359814012711211059","author":{"id":"1133022375051542558","username":"shabear_dis","avatar":"e5046d674427373d76e2dde9dc74feb5","discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"Benito","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":null,"primary_guild":null},"pinned":false,"mention_everyone":false,"tts":false,"position":11},{"type":0,"content":"If I have more questions do you prefer I create a new thread? I also want to know a little more about migration_required for schema upgrades. Is there an example somewhere?","mentions":[],"mention_roles":[],"attachments":[],"embeds":[],"timestamp":"2025-04-10T10:42:58.367000+00:00","edited_timestamp":null,"flags":0,"components":[],"id":"1359841081130225705","channel_id":"1359814012711211059","author":{"id":"583750986527408128","username":"davidalmgren","avatar":null,"discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"David A","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":null,"primary_guild":null},"pinned":false,"mention_everyone":false,"tts":false,"position":10},{"type":0,"content":"Thank you!","mentions":[],"mention_roles":[],"attachments":[],"embeds":[],"timestamp":"2025-04-10T10:36:22.341000+00:00","edited_timestamp":null,"flags":0,"components":[],"id":"1359839420076789810","channel_id":"1359814012711211059","author":{"id":"583750986527408128","username":"davidalmgren","avatar":null,"discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"David A","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":null,"primary_guild":null},"pinned":false,"mention_everyone":false,"tts":false,"position":9},{"type":0,"content":"Thats a really good question, I never try to add back nodes I removed ü§î \n\nI guess if you are adding them back with new attributes, but not the old ones flagged as absent, I wonder if it will restore it with both or just the new ones","mentions":[],"mention_roles":[],"attachments":[],"embeds":[],"timestamp":"2025-04-10T10:33:56.083000+00:00","edited_timestamp":null,"flags":0,"components":[],"id":"1359838806626533457","channel_id":"1359814012711211059","author":{"id":"1133022375051542558","username":"shabear_dis","avatar":"e5046d674427373d76e2dde9dc74feb5","discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"Benito","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":null,"primary_guild":null},"pinned":false,"mention_everyone":false,"tts":false,"position":8},{"type":0,"content":"Okay and this will not result in any issues or strange behaviour if it is decided to add them back again?","mentions":[],"mention_roles":[],"attachments":[],"embeds":[],"timestamp":"2025-04-10T10:00:33.853000+00:00","edited_timestamp":null,"flags":0,"components":[],"id":"1359830408665239662","channel_id":"1359814012711211059","author":{"id":"583750986527408128","username":"davidalmgren","avatar":null,"discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"David A","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":null,"primary_guild":null},"pinned":false,"mention_everyone":false,"tts":false,"position":7},{"type":0,"content":"just removing the nodes form your files, no need to run infrahubctl command again","mentions":[],"mention_roles":[],"attachments":[],"embeds":[],"timestamp":"2025-04-10T09:58:25.339000+00:00","edited_timestamp":null,"flags":0,"components":[],"id":"1359829869638455309","channel_id":"1359814012711211059","author":{"id":"1133022375051542558","username":"shabear_dis","avatar":"e5046d674427373d76e2dde9dc74feb5","discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"Benito","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":null,"primary_guild":null},"pinned":false,"mention_everyone":false,"tts":false,"position":6},{"type":0,"content":"Yes, I understand. Thank you for explaining. How exactly do I perform a ‚Äúcleanup‚Äù? Just manually removing the nodes from the schema definitions or do I also run an infrahubctl command?","mentions":[],"mention_roles":[],"attachments":[],"embeds":[],"timestamp":"2025-04-10T09:57:11.308000+00:00","edited_timestamp":null,"flags":0,"components":[],"id":"1359829559129800834","channel_id":"1359814012711211059","author":{"id":"583750986527408128","username":"davidalmgren","avatar":null,"discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"David A","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":null,"primary_guild":null},"pinned":false,"mention_everyone":false,"tts":false,"position":5},{"type":0,"content":"<@583750986527408128> the idea of managing the schema in a more declarative way is definitely something we are thinking about. it makes a lot of sense and it's clear we'll need to implement it but it's a big change so we need to manage it carefully","mentions":[{"id":"583750986527408128","username":"davidalmgren","avatar":null,"discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"David A","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":null,"primary_guild":null}],"mention_roles":[],"attachments":[],"embeds":[],"timestamp":"2025-04-10T09:54:31.500000+00:00","edited_timestamp":"2025-04-10T09:54:34.007000+00:00","flags":0,"components":[],"id":"1359828888846602250","channel_id":"1359814012711211059","author":{"id":"695690467056025690","username":"dgarros","avatar":"67171294847dca2ce3ac938f5bca0443","discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"Damien","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":{"identity_guild_id":"1212332642801025064","identity_enabled":true,"tag":"OTTO","badge":"40122d86938d2a7824dfd9bd695abe81"},"primary_guild":{"identity_guild_id":"1212332642801025064","identity_enabled":true,"tag":"OTTO","badge":"40122d86938d2a7824dfd9bd695abe81"}},"pinned":false,"mention_everyone":false,"tts":false,"position":4},{"type":0,"content":"after putting state: absent, you can do a \"cleanup\" and remove them","mentions":[],"mention_roles":[],"attachments":[],"embeds":[],"timestamp":"2025-04-10T09:46:48.485000+00:00","edited_timestamp":null,"flags":0,"components":[],"id":"1359826946820935681","channel_id":"1359814012711211059","author":{"id":"1133022375051542558","username":"shabear_dis","avatar":"e5046d674427373d76e2dde9dc74feb5","discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"Benito","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":null,"primary_guild":null},"pinned":false,"mention_everyone":false,"tts":false,"position":3},{"type":0,"content":"Thank you. So there is no way to truly remove the nodes? We just set them to state: absent and leave them like that indefinitely?","mentions":[],"mention_roles":[],"attachments":[],"embeds":[],"timestamp":"2025-04-10T09:35:04.456000+00:00","edited_timestamp":null,"flags":0,"components":[],"id":"1359823993909018786","channel_id":"1359814012711211059","author":{"id":"583750986527408128","username":"davidalmgren","avatar":null,"discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"David A","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":null,"primary_guild":null},"pinned":false,"mention_everyone":false,"tts":false,"position":2},{"type":0,"content":"For the 2nd question, the issue is that the node inheriting from a generic are not update when the generic is update, so the schema validator see a missmatch on the optional field between the node and the generic.\n\nWe have a bug to track this issue. In the mean time, you will have to redeclare the attribute at the node level and keep the same `optional` value as the generic itself","mentions":[],"mention_roles":[],"attachments":[],"embeds":[],"timestamp":"2025-04-10T09:02:17.738000+00:00","edited_timestamp":null,"flags":0,"components":[],"id":"1359815744896106526","channel_id":"1359814012711211059","author":{"id":"1133022375051542558","username":"shabear_dis","avatar":"e5046d674427373d76e2dde9dc74feb5","discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"Benito","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":null,"primary_guild":null},"pinned":false,"mention_everyone":false,"tts":false,"position":1},{"type":0,"content":"Hey David\n\nFor the 1st question, when removing a node from the schema, you need to add `state: absent` on the node itself, and on relationships from the others nodes to the one you are removing\n\nYou can reload the schema without having to delete the branch.\nThe objects insancing the node will be delete along the node schema.\n\nOr if you prefer - you can create a new branch and load the new schema without what you want to delete (mainly if you want to start anew)","mentions":[],"mention_roles":[],"attachments":[],"embeds":[],"timestamp":"2025-04-10T09:00:59.686000+00:00","edited_timestamp":null,"flags":0,"components":[],"id":"1359815417522159626","channel_id":"1359814012711211059","author":{"id":"1133022375051542558","username":"shabear_dis","avatar":"e5046d674427373d76e2dde9dc74feb5","discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"Benito","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":null,"primary_guild":null},"pinned":false,"mention_everyone":false,"tts":false},{"type":0,"content":"Hi,\nI have a couple questions about how schemas work:\n\n1.\nHow can I delete nodes? Say I create a new branch in Infrahub and add 2 new node relations to my BgpSession node. Both nodes are newly added. But then it is decided that only one of the two relations are required. Do I need to remove the relation + node defintion, delete and recreate the branch? What if nodes that live in production become obsolete? How can we remove them?\n\n2.\nHow do schema upgrades work for Generics? If I add the following attribute to SecurityGenericAddressGroup in the infrahub-demo-dc-fabric\n\n- name: test\n  kind: Text\n  optional: false\n\nand load the schema it works fine. If I then change optional: false to optional: true and load the schema I get:\n\nUnable to load the schema:\n  SecurityAddressGroup.test inherited from SecurityGenericAddressGroup must have the same value for property \"optional\" [\"True\", \"False\"]\n\nAt first glance it feels like the schema validation order goes from leaf to root level rather than root to leaf level causing it to fail? What am I missing here? Is it not possible to change generics? I am not encountering this when I \nchange it for regular nodes.\n\nThank you.","mentions":[],"mention_roles":[],"attachments":[],"embeds":[],"timestamp":"2025-04-10T08:55:24.753000+00:00","edited_timestamp":null,"flags":0,"components":[],"id":"1359814012711211059","channel_id":"1359814012711211059","author":{"id":"583750986527408128","username":"davidalmgren","avatar":null,"discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"David A","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":null,"primary_guild":null},"pinned":false,"mention_everyone":false,"tts":false}]}]