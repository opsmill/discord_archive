[{"thread":{"id":"1437895332330737664","type":11,"last_message_id":"1438484094227972097","flags":0,"guild_id":"1212332642801025064","name":"v1.5 upgrade - Generator fails with: Node must have at least one identifier (ID or HFID) to query it","parent_id":"1301914405176475729","rate_limit_per_user":0,"bitrate":64000,"user_limit":0,"rtc_region":null,"owner_id":"918504524610695168","thread_metadata":{"archived":false,"archive_timestamp":"2025-11-11T20:02:42.031000+00:00","auto_archive_duration":4320,"locked":false,"create_timestamp":"2025-11-11T20:02:42.031000+00:00"},"message_count":14,"member_count":2,"total_message_sent":14,"applied_tags":["1304062716125773886"]},"messages":[{"type":0,"content":"","mentions":[],"mention_roles":[],"attachments":[{"id":"1438484094278438922","filename":"image.png","size":44094,"url":"https://cdn.discordapp.com/attachments/1437895332330737664/1438484094278438922/image.png?ex=69340d35&is=6932bbb5&hm=49c36c9474bb96ebad570eae2ab94eaf895955360017065d70d7c8b76f4e3b65&","proxy_url":"https://media.discordapp.net/attachments/1437895332330737664/1438484094278438922/image.png?ex=69340d35&is=6932bbb5&hm=49c36c9474bb96ebad570eae2ab94eaf895955360017065d70d7c8b76f4e3b65&","width":391,"height":610,"content_type":"image/png","original_content_type":"image/png","content_scan_version":2,"placeholder":"O/gFDAJ0iIeIh3D5qCd3gHL52A==","placeholder_version":1}],"embeds":[],"timestamp":"2025-11-13T11:02:13.806000+00:00","edited_timestamp":null,"flags":0,"components":[],"id":"1438484094227972097","channel_id":"1437895332330737664","author":{"id":"1221732604806692884","username":"w_vandeun","avatar":"e9ac2093c5e49a4a05a41b375db9ac69","discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"Wim","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":{"identity_guild_id":"1212332642801025064","identity_enabled":true,"tag":"OTTO","badge":"40122d86938d2a7824dfd9bd695abe81"},"primary_guild":{"identity_guild_id":"1212332642801025064","identity_enabled":true,"tag":"OTTO","badge":"40122d86938d2a7824dfd9bd695abe81"}},"pinned":false,"mention_everyone":false,"tts":false,"position":13,"reactions":[{"emoji":{"id":null,"name":"ðŸ‘"},"count":1,"count_details":{"burst":0,"normal":1},"burst_colors":[],"me_burst":false,"burst_me":false,"me":false,"burst_count":0}]},{"type":0,"content":"Remote the member of groups in the form, that is not needed. Save the trigger rule. Open the rule, navigate to the matches tab, click add match, select the Node Tirgger Relationship Match.","mentions":[],"mention_roles":[],"attachments":[],"embeds":[],"timestamp":"2025-11-13T11:01:45.783000+00:00","edited_timestamp":null,"flags":0,"components":[],"id":"1438483976690995290","channel_id":"1437895332330737664","author":{"id":"1221732604806692884","username":"w_vandeun","avatar":"e9ac2093c5e49a4a05a41b375db9ac69","discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"Wim","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":{"identity_guild_id":"1212332642801025064","identity_enabled":true,"tag":"OTTO","badge":"40122d86938d2a7824dfd9bd695abe81"},"primary_guild":{"identity_guild_id":"1212332642801025064","identity_enabled":true,"tag":"OTTO","badge":"40122d86938d2a7824dfd9bd695abe81"}},"pinned":false,"mention_everyone":false,"tts":false,"position":12},{"type":0,"content":"I'm not sure how to achieve that, can you help? See attached for how I tried it, but it didn't work.","mentions":[],"mention_roles":[],"attachments":[{"id":"1438474565146644551","filename":"Screenshot_2025-11-13_at_11.23.13.png","size":81845,"url":"https://cdn.discordapp.com/attachments/1437895332330737664/1438474565146644551/Screenshot_2025-11-13_at_11.23.13.png?ex=69340455&is=6932b2d5&hm=8fa85bde9df4f6fc0c5770502b408e24dc71285ec2f4a50c231ead508edf9161&","proxy_url":"https://media.discordapp.net/attachments/1437895332330737664/1438474565146644551/Screenshot_2025-11-13_at_11.23.13.png?ex=69340455&is=6932b2d5&hm=8fa85bde9df4f6fc0c5770502b408e24dc71285ec2f4a50c231ead508edf9161&","width":392,"height":1030,"content_type":"image/png","original_content_type":"image/png","content_scan_version":2,"placeholder":"/PcFCwJkZGl4d4T8eHifh/Y=","placeholder_version":1,"title":"Screenshot 2025-11-13 at 11.23.13"},{"id":"1438474565490573403","filename":"Screenshot_2025-11-13_at_11.23.51.png","size":31441,"url":"https://cdn.discordapp.com/attachments/1437895332330737664/1438474565490573403/Screenshot_2025-11-13_at_11.23.51.png?ex=69340455&is=6932b2d5&hm=c28141957a08c05cf12f094c0eac5a20c3dd722b54b71702850860b8e2876e2e&","proxy_url":"https://media.discordapp.net/attachments/1437895332330737664/1438474565490573403/Screenshot_2025-11-13_at_11.23.51.png?ex=69340455&is=6932b2d5&hm=c28141957a08c05cf12f094c0eac5a20c3dd722b54b71702850860b8e2876e2e&","width":1259,"height":85,"content_type":"image/png","original_content_type":"image/png","content_scan_version":2,"placeholder":"/PcFCYKM9ZKEd1d3fA/whoc=","placeholder_version":1,"title":"Screenshot 2025-11-13 at 11.23.51"}],"embeds":[],"timestamp":"2025-11-13T10:24:22.019000+00:00","edited_timestamp":null,"flags":0,"components":[],"id":"1438474565662801921","channel_id":"1437895332330737664","author":{"id":"918504524610695168","username":"dpeach44","avatar":"91d80b360d48938482b8a7e23147d057","discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"dpeach","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":null,"primary_guild":null},"pinned":false,"mention_everyone":false,"tts":false,"position":11},{"type":0,"content":"It seems that when you merge into main, and therefor we add the member to group in the main branch as part of the merge that we don't emit a infrahub.group.member_added  event.\n\nThat is why the generator is not getting triggered when you have `execute_after_merge: false` configured.\n\nInstead for now you'll have to (for now) create a node trigger rule for that group in the default branch, for an update mutation, with a relatioship match on the members relationship.","mentions":[],"mention_roles":[],"attachments":[],"embeds":[],"timestamp":"2025-11-12T21:52:52.723000+00:00","edited_timestamp":null,"flags":0,"components":[],"id":"1438285447447973989","channel_id":"1437895332330737664","author":{"id":"1221732604806692884","username":"w_vandeun","avatar":"e9ac2093c5e49a4a05a41b375db9ac69","discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"Wim","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":{"identity_guild_id":"1212332642801025064","identity_enabled":true,"tag":"OTTO","badge":"40122d86938d2a7824dfd9bd695abe81"},"primary_guild":{"identity_guild_id":"1212332642801025064","identity_enabled":true,"tag":"OTTO","badge":"40122d86938d2a7824dfd9bd695abe81"}},"pinned":false,"mention_everyone":false,"tts":false,"position":10},{"type":0,"content":"For me it worked with `execute_after_merge: true` \nThis was not needed `execute_in_proposed_change: true`","mentions":[],"mention_roles":[],"attachments":[],"embeds":[],"timestamp":"2025-11-12T16:09:32.898000+00:00","edited_timestamp":null,"flags":0,"components":[],"id":"1438199045519577223","channel_id":"1437895332330737664","author":{"id":"1221732604806692884","username":"w_vandeun","avatar":"e9ac2093c5e49a4a05a41b375db9ac69","discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"Wim","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":{"identity_guild_id":"1212332642801025064","identity_enabled":true,"tag":"OTTO","badge":"40122d86938d2a7824dfd9bd695abe81"},"primary_guild":{"identity_guild_id":"1212332642801025064","identity_enabled":true,"tag":"OTTO","badge":"40122d86938d2a7824dfd9bd695abe81"}},"pinned":false,"mention_everyone":false,"tts":false,"position":9},{"type":0,"content":"It appears that you must have `execute_after_merge: true` and `execute_in_proposed_change: true`. Not really clear why though since it only needs to run after merge and when the PC is added to the group, but hey it works.... ðŸ¤·","mentions":[],"mention_roles":[],"attachments":[],"embeds":[],"timestamp":"2025-11-12T14:36:39.512000+00:00","edited_timestamp":null,"flags":0,"components":[],"id":"1438175669044515059","channel_id":"1437895332330737664","author":{"id":"918504524610695168","username":"dpeach44","avatar":"91d80b360d48938482b8a7e23147d057","discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"dpeach","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":null,"primary_guild":null},"pinned":false,"mention_everyone":false,"tts":false,"position":8},{"type":0,"content":"No, in fact, I had it working yesterday exactly as how you are describing it here","mentions":[],"mention_roles":[],"attachments":[],"embeds":[],"timestamp":"2025-11-12T14:13:26.078000+00:00","edited_timestamp":"2025-11-12T14:14:10.024000+00:00","flags":0,"components":[],"id":"1438169824558583989","channel_id":"1437895332330737664","author":{"id":"1221732604806692884","username":"w_vandeun","avatar":"e9ac2093c5e49a4a05a41b375db9ac69","discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"Wim","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":{"identity_guild_id":"1212332642801025064","identity_enabled":true,"tag":"OTTO","badge":"40122d86938d2a7824dfd9bd695abe81"},"primary_guild":{"identity_guild_id":"1212332642801025064","identity_enabled":true,"tag":"OTTO","badge":"40122d86938d2a7824dfd9bd695abe81"}},"pinned":false,"mention_everyone":false,"tts":false,"position":7},{"type":0,"content":"I spoke to soon, the triggering of the generator does not work when the PC is merged. I have a rule which catches when a PC is added to a group, which should happen when a PC is merged. Did something change with the logic here?","mentions":[],"mention_roles":[],"attachments":[{"id":"1438163380757073920","filename":"Screenshot_2025-11-12_at_14.46.52.png","size":30926,"url":"https://cdn.discordapp.com/attachments/1437895332330737664/1438163380757073920/Screenshot_2025-11-12_at_14.46.52.png?ex=69338b45&is=693239c5&hm=628daed776062ff258ab176cc90a5a5bc689cef0c64e7e8b2b2b755ed6cbd9fe&","proxy_url":"https://media.discordapp.net/attachments/1437895332330737664/1438163380757073920/Screenshot_2025-11-12_at_14.46.52.png?ex=69338b45&is=693239c5&hm=628daed776062ff258ab176cc90a5a5bc689cef0c64e7e8b2b2b755ed6cbd9fe&","width":1136,"height":1118,"content_type":"image/webp","original_content_type":"image/png","content_scan_version":2,"placeholder":"/vcBB4DjBtdog3tmh0m2yWh1Ua739nsL","placeholder_version":1,"title":"Screenshot 2025-11-12 at 14.46.52"},{"id":"1438163381193412648","filename":"Screenshot_2025-11-12_at_14.47.28.png","size":36760,"url":"https://cdn.discordapp.com/attachments/1437895332330737664/1438163381193412648/Screenshot_2025-11-12_at_14.47.28.png?ex=69338b45&is=693239c5&hm=b7872386a82936a2f97606aa9eb9967d63a401a9feaf659999b929f01cfa1509&","proxy_url":"https://media.discordapp.net/attachments/1437895332330737664/1438163381193412648/Screenshot_2025-11-12_at_14.47.28.png?ex=69338b45&is=693239c5&hm=b7872386a82936a2f97606aa9eb9967d63a401a9feaf659999b929f01cfa1509&","width":1324,"height":1692,"content_type":"image/webp","original_content_type":"image/png","content_scan_version":2,"placeholder":"/PcFBQDYdXeH+DZ6h5GM5yBWCiJj","placeholder_version":1,"title":"Screenshot 2025-11-12 at 14.47.28"}],"embeds":[],"timestamp":"2025-11-12T13:47:49.956000+00:00","edited_timestamp":null,"flags":0,"components":[],"id":"1438163381596061788","channel_id":"1437895332330737664","author":{"id":"918504524610695168","username":"dpeach44","avatar":"91d80b360d48938482b8a7e23147d057","discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"dpeach","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":null,"primary_guild":null},"pinned":false,"mention_everyone":false,"tts":false,"position":6},{"type":0,"content":"yes I think I did, maybe that was the issue","mentions":[],"mention_roles":[],"attachments":[],"embeds":[],"timestamp":"2025-11-12T08:20:11.913000+00:00","edited_timestamp":null,"flags":0,"components":[],"id":"1438080929787674675","channel_id":"1437895332330737664","author":{"id":"918504524610695168","username":"dpeach44","avatar":"91d80b360d48938482b8a7e23147d057","discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"dpeach","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":null,"primary_guild":null},"pinned":false,"mention_everyone":false,"tts":false,"position":5},{"type":0,"content":"Ok great. Not really sure why that would happen though...\nDid you delete the proposed changes?","mentions":[],"mention_roles":[],"attachments":[],"embeds":[],"timestamp":"2025-11-12T08:15:31.851000+00:00","edited_timestamp":null,"flags":0,"components":[],"id":"1438079755122511892","channel_id":"1437895332330737664","author":{"id":"1221732604806692884","username":"w_vandeun","avatar":"e9ac2093c5e49a4a05a41b375db9ac69","discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"Wim","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":{"identity_guild_id":"1212332642801025064","identity_enabled":true,"tag":"OTTO","badge":"40122d86938d2a7824dfd9bd695abe81"},"primary_guild":{"identity_guild_id":"1212332642801025064","identity_enabled":true,"tag":"OTTO","badge":"40122d86938d2a7824dfd9bd695abe81"}},"pinned":false,"mention_everyone":false,"tts":false,"position":4},{"type":0,"content":"seems I fixed it by deleting those instances, on the next run of the generator it is now working","mentions":[],"mention_roles":[],"attachments":[],"embeds":[],"timestamp":"2025-11-12T07:55:10.763000+00:00","edited_timestamp":null,"flags":0,"components":[],"id":"1438074633508229181","channel_id":"1437895332330737664","author":{"id":"918504524610695168","username":"dpeach44","avatar":"91d80b360d48938482b8a7e23147d057","discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"dpeach","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":null,"primary_guild":null},"pinned":false,"mention_everyone":false,"tts":false,"position":3},{"type":0,"content":"that seems to be the case","mentions":[],"mention_roles":[],"attachments":[{"id":"1438074266078941286","filename":"Screenshot_2025-11-12_at_08.53.23.png","size":183956,"url":"https://cdn.discordapp.com/attachments/1437895332330737664/1438074266078941286/Screenshot_2025-11-12_at_08.53.23.png?ex=6933e107&is=69328f87&hm=fbf5ae12a4de4d3771107dc47d785652081b3276d67a194bb089d5fc935169d4&","proxy_url":"https://media.discordapp.net/attachments/1437895332330737664/1438074266078941286/Screenshot_2025-11-12_at_08.53.23.png?ex=6933e107&is=69328f87&hm=fbf5ae12a4de4d3771107dc47d785652081b3276d67a194bb089d5fc935169d4&","width":2012,"height":438,"content_type":"image/png","original_content_type":"image/png","content_scan_version":2,"placeholder":"/PcBAYCqTOmPNutmQL0MxKo=","placeholder_version":1,"title":"Screenshot 2025-11-12 at 08.53.23"}],"embeds":[],"timestamp":"2025-11-12T07:53:43.202000+00:00","edited_timestamp":null,"flags":0,"components":[],"id":"1438074266250776576","channel_id":"1437895332330737664","author":{"id":"918504524610695168","username":"dpeach44","avatar":"91d80b360d48938482b8a7e23147d057","discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"dpeach","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":null,"primary_guild":null},"pinned":false,"mention_everyone":false,"tts":false,"position":2},{"type":0,"content":"Can you check if you have a generator instance (Actions > Generators) for `deployment_generator` that have no object related to it?","mentions":[],"mention_roles":[],"attachments":[],"embeds":[],"timestamp":"2025-11-11T21:44:15.750000+00:00","edited_timestamp":null,"flags":0,"components":[],"id":"1437920891240579234","channel_id":"1437895332330737664","author":{"id":"1221732604806692884","username":"w_vandeun","avatar":"e9ac2093c5e49a4a05a41b375db9ac69","discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"Wim","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":{"identity_guild_id":"1212332642801025064","identity_enabled":true,"tag":"OTTO","badge":"40122d86938d2a7824dfd9bd695abe81"},"primary_guild":{"identity_guild_id":"1212332642801025064","identity_enabled":true,"tag":"OTTO","badge":"40122d86938d2a7824dfd9bd695abe81"}},"pinned":false,"mention_everyone":false,"tts":false,"position":1},{"type":0,"content":"The actual generator:\n```\nclass DeploymentGenerator(InfrahubGenerator):\n    async def generate(self, data: dict[str, Any]) -> None:\n        change_id = data[\"CoreProposedChange\"][\"edges\"][0][\"node\"][\"id\"]\n        change = await self.client.get(kind=\"CoreProposedChange\", ids=[change_id])\n\n        if change.state.value == \"merged\":\n            deployment_obj = await self.client.create(\n                kind=\"ChangeDeployment\",\n                name=f\"deployment-{change_id}\",\n                status=\"requested\",\n                proposed_change=change,\n            )\n            await deployment_obj.save(allow_upsert=True)\n```\n\nThe generator gets triggered in the following way:\n\n1. Node trigger rule adds PC to a group called `proposed_changes` when a PC is created (all branches).\n2. Group trigger rule triggers generator when PC is added to `proposed_changes` group on the main branch (happens on merge).","mentions":[],"mention_roles":[],"attachments":[],"embeds":[],"timestamp":"2025-11-11T20:02:46.755000+00:00","edited_timestamp":null,"flags":0,"components":[],"id":"1437895352144494613","channel_id":"1437895332330737664","author":{"id":"918504524610695168","username":"dpeach44","avatar":"91d80b360d48938482b8a7e23147d057","discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"dpeach","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":null,"primary_guild":null},"pinned":false,"mention_everyone":false,"tts":false},{"type":0,"content":"Since upgrading to v.1.5 a generator that was previously working now stopped working.\n\nThe task error is:\n```\nEncountered exception during execution: ValueError('Node must have at least one identifier (ID or HFID) to query it.') Traceback (most recent call last): File \"/usr/local/lib/python3.12/site-packages/prefect/flow_engine.py\", line 1357, in run_context yield self File \"/usr/local/lib/python3.12/site-packages/prefect/flow_engine.py\", line 1419, in run_flow_async await engine.call_flow_fn() File \"/usr/local/lib/python3.12/site-packages/prefect/flow_engine.py\", line 1371, in call_flow_fn result = await call_with_parameters(self.flow.fn, self.parameters) ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ File \"/source/backend/infrahub/generators/tasks.py\", line 205, in request_generator_definition_run instance_by_member[instance.object.peer.id] = instance.id ^^^^^^^^^^^^^^^^^^^^ File \"/source/python_sdk/infrahub_sdk/node/related_node.py\", line 214, in peer return self.get() ^^^^^^^^^^ File \"/source/python_sdk/infrahub_sdk/node/related_node.py\", line 226, in get raise ValueError(\"Node must have at least one identifier (ID or HFID) to query it.\") ValueError: Node must have at least one identifier (ID or HFID) to query it.\n```\n\nHere's the generator definition:\n```\n  - name: deployment_generator\n    class_name: DeploymentGenerator\n    file_path: src/generators/deployment_generator.py\n    targets: proposed_changes\n    query: proposed_change_query\n    execute_after_merge: true\n    execute_in_proposed_change: false\n    parameters:\n      proposed_change_id: id\n```\n\nThe query:\n```\nquery ProposedChangeQuery($proposed_change_id: [ID]) {\n  CoreProposedChange(ids: $proposed_change_id) {\n    edges {\n      node {\n        id\n        name {\n          value\n        }\n      }\n    }\n  }\n}\n```","mentions":[],"mention_roles":[],"attachments":[],"embeds":[],"timestamp":"2025-11-11T20:02:42.031000+00:00","edited_timestamp":null,"flags":0,"components":[],"id":"1437895332330737664","channel_id":"1437895332330737664","author":{"id":"918504524610695168","username":"dpeach44","avatar":"91d80b360d48938482b8a7e23147d057","discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"dpeach","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":null,"primary_guild":null},"pinned":false,"mention_everyone":false,"tts":false}]}]