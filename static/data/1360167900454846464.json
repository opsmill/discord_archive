[{"thread":{"id":"1360167900454846464","type":11,"last_message_id":"1361275577931272296","flags":0,"guild_id":"1212332642801025064","name":"Question about tokens","parent_id":"1301914405176475729","rate_limit_per_user":0,"bitrate":64000,"user_limit":0,"rtc_region":null,"owner_id":"583750986527408128","thread_metadata":{"archived":true,"archive_timestamp":"2025-05-14T09:51:26.950000+00:00","auto_archive_duration":4320,"locked":false,"create_timestamp":"2025-04-11T08:21:38.166000+00:00"},"message_count":5,"member_count":4,"total_message_sent":6,"applied_tags":["1301915943663960064","1301915235380363266"]},"messages":[{"type":0,"content":"<@583750986527408128> If you are using a CoreRepository (as opposed to CoreReadOnlyRepository), you don't need to do anything in Github, Infrahub will merge the branch automatically when you merge the Proposed change and it will push the new commit in main to Github","mentions":[{"id":"583750986527408128","username":"davidalmgren","avatar":null,"discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"David A","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":null,"primary_guild":null}],"mention_roles":[],"attachments":[],"embeds":[],"timestamp":"2025-04-14T09:43:09.056000+00:00","edited_timestamp":null,"flags":0,"components":[],"id":"1361275577931272296","channel_id":"1360167900454846464","author":{"id":"695690467056025690","username":"dgarros","avatar":"67171294847dca2ce3ac938f5bca0443","discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"Damien","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":{"identity_guild_id":"1212332642801025064","identity_enabled":true,"tag":"OTTO","badge":"40122d86938d2a7824dfd9bd695abe81"},"primary_guild":{"identity_guild_id":"1212332642801025064","identity_enabled":true,"tag":"OTTO","badge":"40122d86938d2a7824dfd9bd695abe81"}},"pinned":false,"mention_everyone":false,"tts":false,"position":5,"reactions":[{"emoji":{"id":null,"name":"üëç"},"count":1,"count_details":{"burst":0,"normal":1},"burst_colors":[],"me_burst":false,"burst_me":false,"me":false,"burst_count":0}]},{"type":0,"content":"So I will change the tokens but for the INITIAL_ADMIN_TOKEN I will also create a new one in the UI. I assume it is the one called ‚ÄúCreated automatically‚Äù.\n\nAlso, I understand the job of the task worker now. But I have trouble understanding the flow of merging changes. If I create a branch with infrahubctl (with ‚Äîsync-with-git) and make schema changes and merge them via the infrahubctl UI, do I also have to merge that via github? From what I see that is not the case but maybe that is because we are doing something wrong? We have the git repository set up and a PAT added in Infrahub.\n\nAppreciate your response!","mentions":[],"mention_roles":[],"attachments":[],"embeds":[],"timestamp":"2025-04-14T09:40:46.377000+00:00","edited_timestamp":null,"flags":0,"components":[],"id":"1361274979492302929","channel_id":"1360167900454846464","author":{"id":"583750986527408128","username":"davidalmgren","avatar":null,"discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"David A","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":null,"primary_guild":null},"pinned":false,"mention_everyone":false,"tts":false,"position":4},{"type":0,"content":"Changing the `INFRAHUB_INITIAL_ADMIN_TOKEN` after the first startup won't have any effect, as its used only during bootstrap. In order to change that token you have to revoke it and create a new one for the `admin` user (you can do this through the web UI or API).\n\nYou can change `INFRAHUB_SECURITY_SECRET_KEY` afterwise but it will make the previous user sessions invalid since the JWT tokens will become invalid (they will have to log back in).\n\nFor the task worker, is the following documentation not enough to you? https://docs.infrahub.app/topics/architecture#task-worker\nDo you need more information regarding the permissions required for the task workers?","mentions":[],"mention_roles":[],"attachments":[],"embeds":[{"type":"article","url":"https://docs.infrahub.app/topics/architecture","title":"Architecture | Infrahub Documentation","description":"Infrahub is deployed as a container-based architecture, composed of multiple components. A minimum deployment consists of the following architecture:","content_scan_version":2}],"timestamp":"2025-04-14T09:09:33.629000+00:00","edited_timestamp":null,"flags":0,"components":[],"id":"1361267124617871492","channel_id":"1360167900454846464","author":{"id":"1220422159676084304","username":"fatih_10382_62805","avatar":null,"discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"fatih","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":{"identity_guild_id":"1212332642801025064","identity_enabled":true,"tag":"OTTO","badge":"40122d86938d2a7824dfd9bd695abe81"},"primary_guild":{"identity_guild_id":"1212332642801025064","identity_enabled":true,"tag":"OTTO","badge":"40122d86938d2a7824dfd9bd695abe81"}},"pinned":false,"mention_everyone":false,"tts":false,"position":2},{"type":0,"content":"Thank you for the response. Some follow-up questions:\n\nif I shut down the server and change the INFRAHUB_INITIAL_ADMIN_TOKEN will it change or does it require a complete DB wipe? Same for the security key.\n\nCan you give me examples of the purpose of the task worker vs other ‚Äúusers‚Äù? And also what operations are relevant for both?","mentions":[],"mention_roles":[],"attachments":[],"embeds":[],"timestamp":"2025-04-14T07:36:57.852000+00:00","edited_timestamp":null,"flags":0,"components":[],"id":"1361243822000046141","channel_id":"1360167900454846464","author":{"id":"583750986527408128","username":"davidalmgren","avatar":null,"discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"David A","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":null,"primary_guild":null},"pinned":false,"mention_everyone":false,"tts":false,"position":1},{"type":0,"content":"Hi, this deserves better documentation... sorry for that, we will fix this\nTo override the default token for the helm chart, you need to null them before using envFromExistingSecret\nfor example\n```\ninfrahubServer:\n  infrahubServer:\n    env:\n      INFRAHUB_INITIAL_ADMIN_TOKEN: null\n``` \nThis is not so obvious and I believe not the best way to do this, we'll try to implement a better approach to correctly pass secrets with Helm...\n\nThe `INFRAHUB_INITIAL_ADMIN_TOKEN` is a token with full privileges that is created at Infrahub's first startup. It is then used by the task workers and other components to communicate with Infrahub's APIs.\nAn alternative is to use the `INFRAHUB_INITIAL_AGENT_TOKEN` config that will create a token with lesser privileges, for the task worker (so that you can keep `INFRAHUB_INITIAL_ADMIN_TOKEN` exclusively for operations that require full privileges.\n\n`INFRAHUB_SECURITY_SECRET_KEY` is a secret key used to generate JWT tokens (they are used when you login as a user to Infrahub).","mentions":[],"mention_roles":[],"attachments":[],"embeds":[],"timestamp":"2025-04-13T16:43:52.514000+00:00","edited_timestamp":null,"flags":0,"components":[],"id":"1361019068802531458","channel_id":"1360167900454846464","author":{"id":"1220422159676084304","username":"fatih_10382_62805","avatar":null,"discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"fatih","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":{"identity_guild_id":"1212332642801025064","identity_enabled":true,"tag":"OTTO","badge":"40122d86938d2a7824dfd9bd695abe81"},"primary_guild":{"identity_guild_id":"1212332642801025064","identity_enabled":true,"tag":"OTTO","badge":"40122d86938d2a7824dfd9bd695abe81"}},"pinned":false,"mention_everyone":false,"tts":false},{"type":0,"content":"Hi, I have a couple of questions/concerns about deploying the infrahub-enterprise helm chart:\n\nI do not think it is possible to change the INFRAHUB_API_TOKEN/INFRAHUB_INITIAL_ADMIN_TOKEN/INFRAHUB_SECURITY_SECRET_KEY using a secret in the infrahub-enterprise helm chart. I see in the Infrahub values.yaml that it already has them defined. So they will always have precedence over the envFromExistingSecret values.\n\nCan you tell me exactly how the INFRAHUB_API_TOKEN/INFRAHUB_INITIAL_ADMIN_TOKEN works? I see both the infrahubServer and InfrahubTaskWorker requires this token. Can I change this token somehow? If I go into Tokens in the UI I see a token called \"Created automatically\". Is that the one? I can't seem to edit it so I feel like removing it and creating a new one is destructive. Will the task worker also be updated with this token automagically? Also, what happens if I shut down the server and set a new INFRAHUB_INITIAL_ADMIN_TOKEN? It has initial in it's name so will it actually change it?\n\nCan you also tell me about the INFRAHUB_SECURITY_SECRET_KEY token? What is it for? There is no documentation for it? Do we need to keep it secrect? Should we care about changing it from the default value?","mentions":[],"mention_roles":[],"attachments":[],"embeds":[],"timestamp":"2025-04-11T08:21:38.166000+00:00","edited_timestamp":null,"flags":0,"components":[],"id":"1360167900454846464","channel_id":"1360167900454846464","author":{"id":"583750986527408128","username":"davidalmgren","avatar":null,"discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"David A","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":null,"primary_guild":null},"pinned":false,"mention_everyone":false,"tts":false}]}]