[{"thread":{"id":"1415297896470810654","type":11,"last_message_id":"1416060284254158918","flags":0,"guild_id":"1212332642801025064","name":"Trigger artifact generation using rule, action and generator","parent_id":"1301914405176475729","rate_limit_per_user":0,"bitrate":64000,"user_limit":0,"rtc_region":null,"owner_id":"918504524610695168","thread_metadata":{"archived":true,"archive_timestamp":"2025-10-12T14:00:57.092000+00:00","auto_archive_duration":4320,"locked":false,"create_timestamp":"2025-09-10T11:28:33.482000+00:00"},"message_count":15,"member_count":4,"total_message_sent":16,"applied_tags":["1301914968001744937"]},"messages":[{"type":0,"content":"> Do you guys plan to add artifact generation/transformation as a rule trigger action directly? That would be handy.\nYes we were talking about it yesterday\nWe like the idea very much but I think we need to implement some additional features to prevent the same artifacts to be generated for each event, in some cases we could end up with a lot of events that are related to the same device.","mentions":[],"mention_roles":[],"attachments":[],"embeds":[],"timestamp":"2025-09-12T13:58:00.894000+00:00","edited_timestamp":null,"flags":0,"components":[],"id":"1416060284254158918","channel_id":"1415297896470810654","author":{"id":"695690467056025690","username":"dgarros","avatar":"67171294847dca2ce3ac938f5bca0443","discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"Damien","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":{"identity_guild_id":"1212332642801025064","identity_enabled":true,"tag":"OTTO","badge":"40122d86938d2a7824dfd9bd695abe81"},"primary_guild":{"identity_guild_id":"1212332642801025064","identity_enabled":true,"tag":"OTTO","badge":"40122d86938d2a7824dfd9bd695abe81"}},"pinned":false,"mention_everyone":false,"tts":false,"position":15,"reactions":[{"emoji":{"id":null,"name":"ðŸ‘"},"count":2,"count_details":{"burst":0,"normal":2},"burst_colors":[],"me_burst":false,"burst_me":false,"me":false,"burst_count":0}]},{"type":0,"content":"So I finally got this working with the following `.infrahub.yml`:\n```\ngenerator_definitions:\n  - name: device_artifact_generator\n    class_name: DeviceArtifactGenerator\n    file_path: src/generators/device_artifact_generator.py\n    targets: interfaces\n    query: interface_device_query\n    parameters:\n      interface_id: id\n```\nquery:\n```\nquery InterfaceDeviceQuery($interface_id: [ID]) {\n  InfraInterfaceL3(ids: $interface_id) {\n    edges {\n      node {\n        id\n        name {\n          value\n        }\n        device {\n          node {\n            name {\n              value\n            }\n          }\n        }\n      }\n    }\n  }\n}\n```\ngenerator:\n```\nclass DeviceArtifactGenerator(InfrahubGenerator):\n    async def generate(self, data: dict[str, Any]) -> None:\n        device_name = data[\"InfraInterfaceL3\"][\"edges\"][0][\"node\"][\"device\"][\"node\"][\"name\"][\"value\"]\n        client = InfrahubClientSync()\n        device = client.get(kind=\"InfraDevice\", name__value=device_name)\n        device.artifact_generate(name=\"Device config YAML\")\n```\n\nI also had to create an interfaces group and add the interfaces there. One small side effect is that if an interface is changed in a PC then the generator runs the artifact generation which is a duplication of the PC artifact generation. I don't think it breaks anything but it's uneccessary. \n\nDo you guys plan to add artifact generation/transformation as a rule trigger action directly? That would be handy.\n\nCheers.","mentions":[],"mention_roles":[],"attachments":[],"embeds":[],"timestamp":"2025-09-12T09:39:45.200000+00:00","edited_timestamp":"2025-09-12T09:53:27.339000+00:00","flags":0,"components":[],"id":"1415995290602836029","channel_id":"1415297896470810654","author":{"id":"918504524610695168","username":"dpeach44","avatar":"91d80b360d48938482b8a7e23147d057","discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"dpeach","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":null,"primary_guild":null},"pinned":false,"mention_everyone":false,"tts":false,"position":14},{"type":0,"content":"Thanks for the suggestions guys I'll investigate this further","mentions":[],"mention_roles":[],"attachments":[],"embeds":[],"timestamp":"2025-09-10T18:57:03.707000+00:00","edited_timestamp":null,"flags":0,"components":[],"id":"1415410766135300226","channel_id":"1415297896470810654","author":{"id":"918504524610695168","username":"dpeach44","avatar":"91d80b360d48938482b8a7e23147d057","discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"dpeach","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":null,"primary_guild":null},"pinned":false,"mention_everyone":false,"tts":false,"position":13},{"type":0,"content":"Also since we're talking about trigger and action, in the release that went out today (1.4.6)  we added an new option to match a trigger on any values of an attribute where previously it was required to match on a specific value.","mentions":[],"mention_roles":[],"attachments":[],"embeds":[],"timestamp":"2025-09-10T18:09:43.673000+00:00","edited_timestamp":null,"flags":0,"components":[],"id":"1415398854169460756","channel_id":"1415297896470810654","author":{"id":"695690467056025690","username":"dgarros","avatar":"67171294847dca2ce3ac938f5bca0443","discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"Damien","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":{"identity_guild_id":"1212332642801025064","identity_enabled":true,"tag":"OTTO","badge":"40122d86938d2a7824dfd9bd695abe81"},"primary_guild":{"identity_guild_id":"1212332642801025064","identity_enabled":true,"tag":"OTTO","badge":"40122d86938d2a7824dfd9bd695abe81"}},"pinned":false,"mention_everyone":false,"tts":false,"position":12},{"type":0,"content":"For it to work you need to have a generator that expect an interface and then query the device as part of the GraphQL query, this also means that the interface will need to be part of a group.","mentions":[],"mention_roles":[],"attachments":[],"embeds":[],"timestamp":"2025-09-10T17:30:09.600000+00:00","edited_timestamp":null,"flags":0,"components":[],"id":"1415388896585449684","channel_id":"1415297896470810654","author":{"id":"695690467056025690","username":"dgarros","avatar":"67171294847dca2ce3ac938f5bca0443","discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"Damien","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":{"identity_guild_id":"1212332642801025064","identity_enabled":true,"tag":"OTTO","badge":"40122d86938d2a7824dfd9bd695abe81"},"primary_guild":{"identity_guild_id":"1212332642801025064","identity_enabled":true,"tag":"OTTO","badge":"40122d86938d2a7824dfd9bd695abe81"}},"pinned":false,"mention_everyone":false,"tts":false,"position":11},{"type":0,"content":"<@918504524610695168> your question is very timely, we are actively working on this question right now with <@1221732604806692884> \nI think the issue here is that your generator is expecting a device but the object passed to it by the action trigger is an interface","mentions":[{"id":"918504524610695168","username":"dpeach44","avatar":"91d80b360d48938482b8a7e23147d057","discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"dpeach","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":null,"primary_guild":null},{"id":"1221732604806692884","username":"w_vandeun","avatar":"e9ac2093c5e49a4a05a41b375db9ac69","discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"Wim","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":{"identity_guild_id":"1212332642801025064","identity_enabled":true,"tag":"OTTO","badge":"40122d86938d2a7824dfd9bd695abe81"},"primary_guild":{"identity_guild_id":"1212332642801025064","identity_enabled":true,"tag":"OTTO","badge":"40122d86938d2a7824dfd9bd695abe81"}}],"mention_roles":[],"attachments":[],"embeds":[],"timestamp":"2025-09-10T17:29:06.491000+00:00","edited_timestamp":null,"flags":0,"components":[],"id":"1415388631887118366","channel_id":"1415297896470810654","author":{"id":"695690467056025690","username":"dgarros","avatar":"67171294847dca2ce3ac938f5bca0443","discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"Damien","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":{"identity_guild_id":"1212332642801025064","identity_enabled":true,"tag":"OTTO","badge":"40122d86938d2a7824dfd9bd695abe81"},"primary_guild":{"identity_guild_id":"1212332642801025064","identity_enabled":true,"tag":"OTTO","badge":"40122d86938d2a7824dfd9bd695abe81"}},"pinned":false,"mention_everyone":false,"tts":false,"position":10},{"type":0,"content":"The generator has access to the node that the group is a member of so you can access the data directly.","mentions":[],"mention_roles":[],"attachments":[],"embeds":[],"timestamp":"2025-09-10T14:49:36.863000+00:00","edited_timestamp":null,"flags":0,"components":[],"id":"1415348493958254713","channel_id":"1415297896470810654","author":{"id":"227091130561331200","username":"minitriga.","avatar":"71ac6f8da9c358794381d5d430c53316","discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"Alex Gittings","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":null,"primary_guild":null},"pinned":false,"mention_everyone":false,"tts":false,"position":9},{"type":0,"content":"Change your params to `name__value`","mentions":[],"mention_roles":[],"attachments":[],"embeds":[],"timestamp":"2025-09-10T14:49:07.142000+00:00","edited_timestamp":null,"flags":0,"components":[],"id":"1415348369299210424","channel_id":"1415297896470810654","author":{"id":"227091130561331200","username":"minitriga.","avatar":"71ac6f8da9c358794381d5d430c53316","discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"Alex Gittings","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":null,"primary_guild":null},"pinned":false,"mention_everyone":false,"tts":false,"position":8},{"type":0,"content":"Yeah my devices are in the group. I wondered if this part is correct in the generator definition:\n```\n    parameters:\n      device: device__node__name__value\n```\nI assumed here that the Interface node object is provided as input and therefore I could use `device__node__name__value` to get the name of the device that the interface is related to, but that was a bit of a guess.","mentions":[],"mention_roles":[],"attachments":[{"id":"1415330608363733113","filename":"Screenshot_2025-09-10_at_15.35.46.png","size":136278,"url":"https://cdn.discordapp.com/attachments/1415297896470810654/1415330608363733113/Screenshot_2025-09-10_at_15.35.46.png?ex=69338918&is=69323798&hm=e900363a6af6b0fe8dde175980ec936817b3e49b4d26ab1563d1feaccd474a38&","proxy_url":"https://media.discordapp.net/attachments/1415297896470810654/1415330608363733113/Screenshot_2025-09-10_at_15.35.46.png?ex=69338918&is=69323798&hm=e900363a6af6b0fe8dde175980ec936817b3e49b4d26ab1563d1feaccd474a38&","width":784,"height":1142,"content_type":"image/png","original_content_type":"image/png","content_scan_version":2,"placeholder":"/fcBBQCnVn+HqId5dnVnd/h3ju36","placeholder_version":1,"title":"Screenshot 2025-09-10 at 15.35.46"}],"embeds":[],"timestamp":"2025-09-10T13:38:32.617000+00:00","edited_timestamp":null,"flags":0,"components":[],"id":"1415330608414199890","channel_id":"1415297896470810654","author":{"id":"918504524610695168","username":"dpeach44","avatar":"91d80b360d48938482b8a7e23147d057","discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"dpeach","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":null,"primary_guild":null},"pinned":false,"mention_everyone":false,"tts":false,"position":7},{"type":0,"content":"can you ensure your device node has been attached to the `devices` group?","mentions":[],"mention_roles":[],"attachments":[],"embeds":[],"timestamp":"2025-09-10T12:58:38.310000+00:00","edited_timestamp":null,"flags":0,"components":[],"id":"1415320565962768475","channel_id":"1415297896470810654","author":{"id":"227091130561331200","username":"minitriga.","avatar":"71ac6f8da9c358794381d5d430c53316","discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"Alex Gittings","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":null,"primary_guild":null},"pinned":false,"mention_everyone":false,"tts":false,"position":6},{"type":0,"content":"I see this `Successfully run 0 generators` If I run a generator that has nothing attached to the group defined","mentions":[],"mention_roles":[],"attachments":[],"embeds":[],"timestamp":"2025-09-10T12:58:07.042000+00:00","edited_timestamp":null,"flags":0,"components":[],"id":"1415320434815008889","channel_id":"1415297896470810654","author":{"id":"227091130561331200","username":"minitriga.","avatar":"71ac6f8da9c358794381d5d430c53316","discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"Alex Gittings","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":null,"primary_guild":null},"pinned":false,"mention_everyone":false,"tts":false,"position":5},{"type":0,"content":"Ha, yeah, I'm constantly confused by discord ðŸ˜•","mentions":[],"mention_roles":[],"attachments":[{"id":"1415312528476606535","filename":"Screenshot_2025-09-10_at_14.21.17.png","size":79080,"url":"https://cdn.discordapp.com/attachments/1415297896470810654/1415312528476606535/Screenshot_2025-09-10_at_14.21.17.png?ex=69337842&is=693226c2&hm=e80e7d9b8957702aa8dbb25164ffc38c5aff7c8caa483fefb3fc086efe371cd7&","proxy_url":"https://media.discordapp.net/attachments/1415297896470810654/1415312528476606535/Screenshot_2025-09-10_at_14.21.17.png?ex=69337842&is=693226c2&hm=e80e7d9b8957702aa8dbb25164ffc38c5aff7c8caa483fefb3fc086efe371cd7&","width":4196,"height":150,"content_type":"image/png","original_content_type":"image/png","content_scan_version":2,"placeholder":"+/cFAYCDqGe5aAZ1daOQjwg=","placeholder_version":1,"title":"Screenshot 2025-09-10 at 14.21.17"}],"embeds":[],"timestamp":"2025-09-10T12:26:42.075000+00:00","edited_timestamp":null,"flags":0,"components":[],"id":"1415312528690647262","channel_id":"1415297896470810654","author":{"id":"918504524610695168","username":"dpeach44","avatar":"91d80b360d48938482b8a7e23147d057","discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"dpeach","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":null,"primary_guild":null},"pinned":false,"mention_everyone":false,"tts":false,"position":4},{"type":0,"content":"You did the same as me. I need to disable enter to send.","mentions":[],"mention_roles":[],"attachments":[],"embeds":[],"timestamp":"2025-09-10T12:21:52.152000+00:00","edited_timestamp":null,"flags":0,"components":[],"id":"1415311312665182351","channel_id":"1415297896470810654","author":{"id":"227091130561331200","username":"minitriga.","avatar":"71ac6f8da9c358794381d5d430c53316","discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"Alex Gittings","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":null,"primary_guild":null},"pinned":false,"mention_everyone":false,"tts":false,"position":2,"reactions":[{"emoji":{"id":null,"name":"ðŸ‘"},"count":1,"count_details":{"burst":0,"normal":1},"burst_colors":[],"me_burst":false,"burst_me":false,"me":false,"burst_count":0}]},{"type":0,"content":"Hi Alex,\n\nYeah I realise I'm abusing the generator here but I thought it should work.\n\nI see two tasks kicked off but the second one has `Finished in state Completed('Successfully run 0 generators')` in the log so I guess it's not actually running the specific generator.\n\nTriggering artifact generation directly would be great ðŸ‘ \n\nThe use case is a workflow outside of Infrahub (server provisioning) which would configure access ports in Infrahub and trigger configuration on leaf switches. It doesn't need to go through a proposed change.\n\nCheers,\n\nDan","mentions":[],"mention_roles":[],"attachments":[],"embeds":[],"timestamp":"2025-09-10T12:21:31.287000+00:00","edited_timestamp":"2025-09-10T12:24:33.773000+00:00","flags":0,"components":[],"id":"1415311225151029331","channel_id":"1415297896470810654","author":{"id":"918504524610695168","username":"dpeach44","avatar":"91d80b360d48938482b8a7e23147d057","discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"dpeach","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":null,"primary_guild":null},"pinned":false,"mention_everyone":false,"tts":false,"position":1},{"type":0,"content":"Hi Dan,\n\nGenerators in Infrahub are designed to create new nodes and relationships, not to trigger artifact generation although it can we probably need to improve this by having a new action in here to trigger artifact generation automatically based on an event. \n\nDo you see a task being kicked off for the artifact generation in `/tasks`?\n\nAnother question how come the need for generating the configuration outside of the proposed change?","mentions":[],"mention_roles":[],"attachments":[],"embeds":[],"timestamp":"2025-09-10T12:12:46.435000+00:00","edited_timestamp":"2025-09-10T12:19:53.339000+00:00","flags":0,"components":[],"id":"1415309023762317448","channel_id":"1415297896470810654","author":{"id":"227091130561331200","username":"minitriga.","avatar":"71ac6f8da9c358794381d5d430c53316","discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"Alex Gittings","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":null,"primary_guild":null},"pinned":false,"mention_everyone":false,"tts":false},{"type":0,"content":"Hi team,\n\nI'm trying to get the following to work but struggling:\n\n1. Interace is updated\n2. Rule for interface update triggers a generator action\n3. Generator action runs a generator\n4. Generator gets the device that the interface is related to\n5. Generator triggers artifact generation for that device\n\nHere's the relevant part of my `.infrahub.yml`:\n```\ngenerator_definitions:\n  - name: device_artifact_generator\n    class_name: DeviceArtifactGenerator\n    file_path: src/generators/device_artifact_generator.py\n    targets: devices\n    query: interface_device_query\n    parameters:\n      device: device__node__name__value\n```\n...the query:\n```\nquery DeviceQuery($device: String!) {\n  InfraDevice(name__value: $device) {\n    edges {\n      node {\n        name {\n          value\n        }\n      }\n    }\n  }\n}\n```\n...and the generator:\n```\nclass DeviceArtifactGenerator(InfrahubGenerator):\n    async def generate(self, data: dict[str, Any]) -> None:\n        device_name = data[\"InfraDevice\"][\"edges\"][0][\"node\"][\"name\"][\"value\"]\n        client = InfrahubClientSync()\n        device = client.get(kind=\"InfraDevice\", name__value=device_name)\n        device.artifact_generate(name=\"Device config YAML\")\n```\n\nThe generator appears to get triggered correctly but the artifact itself doesn't get generated/updated.\n\nAny clues where I am going wrong here?\n\nThanks,\n\nDan","mentions":[],"mention_roles":[],"attachments":[],"embeds":[],"timestamp":"2025-09-10T11:28:33.482000+00:00","edited_timestamp":"2025-09-10T11:38:34.865000+00:00","flags":0,"components":[],"id":"1415297896470810654","channel_id":"1415297896470810654","author":{"id":"918504524610695168","username":"dpeach44","avatar":"91d80b360d48938482b8a7e23147d057","discriminator":"0","public_flags":0,"flags":0,"banner":null,"accent_color":null,"global_name":"dpeach","avatar_decoration_data":null,"collectibles":null,"display_name_styles":null,"banner_color":null,"clan":null,"primary_guild":null},"pinned":false,"mention_everyone":false,"tts":false}]}]